# 2018.07.30  

## Review TCP

TCP和UDP都是传输层协议，区别在于有无连接、是否可靠、能否保证数据的顺序以及正确性。

### 三次握手  

连接建立过程如下：

1. C发送SYN请求报文
2. S接收到SYN报文，发送ACK报文，并分配资源  
3. C接收到ACK报文后，向S发送ACK并分配资源  

### 四次挥手

C与S端都可以主动关闭连接，断开连接过程如下：  

1. C(S)发送FIN报文
2. S(C)接收到FIN报文，可能这个时候有数据未处理完，不能立刻关闭socket，S(C)发送ACK。C(S)接收到ACK报文后，进入FIN_WAIT等待时间。
3. S(C)发送FIN报文，表示可以断开连接了。
4. C(S)接收到FIN报文，发送ACK报文，并进入等待时间。S(C)接收到ACK报文之后立刻关闭连接。C(S)在等待2MSL时间后，确认S(C)已经关闭完成，C(S)关闭连接。

### 为什么要三次握手四次挥手

在TCP连接建立时，S接收到C的SYN的连接请求报文后，可以直接发送SYN+ACK报文，其中ACK报文是用来应答的，SYN报文是用来同步的；但是在关闭连接时，S收到FIN报文时，很可能不会立刻关闭socket，所以只能先回复一个ACK报文，通知C FIN报文收到了，只有在S所有报文都发送完毕后，再发送FIN报文，因此FIN与ACK不能一起发送，所以会四次挥手。

## Review HTTP

HTTP协议用于从万维网服务器传输超文本到本地浏览器的传送协议，基于TCP/IP通信协议来传递数据，属于应用层协议。  
HTTP是基于客户端/服务端（C/S）的架构模型，通过一个可靠的链接来交换信息，是一个无状态的请求/响应协议。  
HTTP使用统一资源标识符（URI）来传输数据和建立连接。  

HTTP的一些特点：
- HTTP是无连接的：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。  

- HTTP是媒体独立的：这意味着，只要客户端和服务器知道如何处理的数据内容，任何类型的数据都可以通过HTTP发送。客户端以及服务器指定使用适合的MIME-type内容类型。

- HTTP是无状态的：HTTP协议是无状态协议。无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大。另一方面，在服务器不需要先前信息时它的应答就较快。

### HTTP消息结构

#### 客户端请求消息

1. 请求行（url）
2. 请求头（字段：值，包括User-Agent等信息）
3. 请求数据（主要是post方法使用时添加的消息字段）

#### 服务器返回数据

1. 状态行（状态码）
2. 消息报头（返回时间、数据类型、数据长度等）
3. 响应正文

### HTTP get和post请求方法

http默认的请求方法有很多，但是主要使用的是get、post两种方法。主观上的差距：
1. get参数通过url传递，post参数放在请求数据中。
2. get请求在url中是有长度限制的，post没有。
3. get请求只能使用url编码，post没有限制。也就是说，get请求只接收ASCII字符，post没有限制。
4. get没有post安全，因为参数直接暴露在url上，所以不能用来传递敏感信息。 
...（还有很多关于浏览器缓存和回退的区别）

实际上get、post方法本质都是TCP链接，本质上并没有任何差别。post方法也可以把参数拼接在url上，get方法也可以在请求数据中加入参数。但是不同的服务器对于http请求数据的处理方式是不同的，有的服务器可能会在get请求中把你请求数据中的参数提取出来，或者把你post方法中url后面拼接的数据提取出来处理，所以说在get方法请求体中添加数据不一定会被接收到，post方法同理。  

另一方面，url中不能无限添加参数，数据量太大会对服务器和浏览器在成负担，为了控制风险，解决方案就是限制单词运输量，所以大多数浏览器会限制url在2k之中，服务器限制在64k。所以说，由于http的规定和浏览器以及服务器的限制，get和post方法在应用过程中体现出了一些不同。

但是，get和post还有一个重要的区别：**get产生一个TCP数据包，post产生两个TCP数据包**。  

具体表现为：
1. get方法时，直接把请求头和请求数据一同发送出去，服务器进行响应。
2. post方法时，先发送请求头，服务器返回100 continune，再发送请求数据，服务器进行响应。